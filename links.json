const readline = require('readline');
const { clear } = require('console');
const request = require('request-promise-native');
const cheerio = require('cheerio');
const fs = require('fs');
const color = require('chalk');
const { exit } = require('process');

const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout
});

const headers = {
  'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; ) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4086.0 Safari/537.36',
  'Connection': 'keep-alive',
  'Host': 'iknowwhatyoudownload.com',
  'Referer': 'https://iknowwhatyoudownload.com'
};

const input_string = 'ip';
const launage_str = 'en';
const first_use = 'Visto pela primeira vez: ';
const last_use = 'visto pela Ãºltima vez: ';
const torrent_category = 'category: ';
const name_torrent = 'nome do arquivo: ';
const size_torrent = 'tamanho do arquivo: ';
const save_choice = 'Salvar? y/n ';

const main = async () => {
  console.log(color.green(''));

  console.log(color.green(`

 ______   ___   ____   ____     ___  ____   ______ 
|      | /   \\ |    \\ |    \\   /  _]|    \\ |      |
|      ||     ||  D  )|  D  ) /  [_ |  _  ||      |
|_|  |_|\\  O  ||    / |    / |    _]|  |  ||_|  |_|
  |  |  |     ||    \\ |    \\ |   [_ |  |  |  |  |  
  |  |  |     ||  .  \\\\|  .  \\\\|     ||  |  |  |  |  
  |__|   \\___/ |__|\\_||__|\\_||_____||__|__|  |__|  
                                                    
              > Created by baalware
`));

  const ip = await new Promise(resolve => {
    rl.question(`${input_string}: `, answer => {
      resolve(answer);
    });
  });

  const save = await new Promise(resolve => {
    rl.question(`${save_choice}`, answer => {
      resolve(answer.toLowerCase());
    });
  });

  console.log('');

  const url = `https://iknowwhatyoudownload.com/${launage_str}/peer/?ip=${ip}`;

  const html = await request({ url, headers });

  const $ = cheerio.load(html);
  const torrents = $('table tbody tr');
  const results = [];

  clear();

  console.log(color.green(`

 ______   ___   ____   ____     ___  ____   ______ 
|      | /   \\ |    \\ |    \\   /  _]|    \\ |      |
|      ||     ||  D  )|  D  ) /  [_ |  _  ||      |
|_|  |_|\\  O  ||    / |    / |    _]|  |  ||_|  |_|
  |  |  |     ||    \\ |    \\ |   [_ |  |  |  |  |  
  |  |  |     ||  .  \\\\|  .  \\\\|     ||  |  |  |  |  
  |__|   \\___/ |__|\\_||__|\\_||_____||__|__|
